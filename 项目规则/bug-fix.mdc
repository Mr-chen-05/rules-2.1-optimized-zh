---
description: "Complete bug-fixing workflow from issue to PR - ä»é—®é¢˜åˆ°PRçš„å®Œæ•´Bugä¿®å¤å·¥ä½œæµ"
globs: ["**/*"]
alwaysApply: false
---

# ğŸ› Bug Fix Workflow - Bugä¿®å¤å·¥ä½œæµ

ä»é—®é¢˜åˆ›å»ºåˆ°æ‹‰å–è¯·æ±‚çš„å®Œæ•´Bugä¿®å¤å·¥ä½œæµç¨‹ã€‚

## ğŸš€ Commands - å‘½ä»¤

- `/bug-fix` - å¯åŠ¨Bugä¿®å¤å·¥ä½œæµ
- `/reproduce-bug` - é‡ç°Bug
- `/root-cause` - æ ¹å› åˆ†æ
- `/fix-verify` - ä¿®å¤éªŒè¯

## ğŸ“‹ Process - ä¿®å¤æµç¨‹

### ğŸ” Before Starting - å¼€å§‹å‰å‡†å¤‡

#### 1. GitHub Issue Creation - åˆ›å»ºGitHubé—®é¢˜
```markdown
**Bugæ ‡é¢˜**: [ç»„ä»¶/æ¨¡å—] ç®€çŸ­æè¿°æ€§æ ‡é¢˜

**ç¯å¢ƒä¿¡æ¯**:
- æ“ä½œç³»ç»Ÿ: Windows 11 / macOS 13 / Ubuntu 22.04
- æµè§ˆå™¨: Chrome 120 / Firefox 121 / Safari 17
- åº”ç”¨ç‰ˆæœ¬: v2.1.0
- Node.jsç‰ˆæœ¬: v18.19.0

**é‡ç°æ­¥éª¤**:
1. æ‰“å¼€åº”ç”¨
2. ç‚¹å‡»ç™»å½•æŒ‰é’®
3. è¾“å…¥æœ‰æ•ˆå‡­æ®
4. ç‚¹å‡»æäº¤

**é¢„æœŸè¡Œä¸º**: ç”¨æˆ·åº”è¯¥æˆåŠŸç™»å½•å¹¶è·³è½¬åˆ°ä»ªè¡¨æ¿

**å®é™…è¡Œä¸º**: æ˜¾ç¤º"ç½‘ç»œé”™è¯¯"ï¼Œç”¨æˆ·åœç•™åœ¨ç™»å½•é¡µé¢

**é”™è¯¯ä¿¡æ¯**:
```
TypeError: Cannot read property 'token' of undefined
  at LoginComponent.handleLogin (login.component.ts:45)
```

**æˆªå›¾/å½•å±**: [é™„åŠ ç›¸å…³æˆªå›¾æˆ–å½•å±]

**ä¼˜å…ˆçº§**: High / Medium / Low
**æ ‡ç­¾**: bug, frontend, authentication
```

#### 2. Git Branch Creation - åˆ›å»ºGitåˆ†æ”¯
```bash
# åˆ›å»ºå¹¶åˆ‡æ¢åˆ°åŠŸèƒ½åˆ†æ”¯
git checkout -b fix/login-token-error

# æˆ–è€…ä½¿ç”¨æ›´å…·æè¿°æ€§çš„åˆ†æ”¯å
git checkout -b fix/issue-123-login-authentication-error
```

### ğŸ”§ Fix the Bug - ä¿®å¤Bug

#### Step 1: Reproduce the Issue - é‡ç°é—®é¢˜
```bash
# 1. åˆ‡æ¢åˆ°é—®é¢˜åˆ†æ”¯
git checkout main
git pull origin main

# 2. å°è¯•é‡ç°Bug
npm start
# æŒ‰ç…§é—®é¢˜æè¿°çš„æ­¥éª¤æ“ä½œ

# 3. ç¡®è®¤é—®é¢˜å­˜åœ¨
# è®°å½•é‡ç°æ­¥éª¤å’Œé”™è¯¯ä¿¡æ¯
```

#### Step 2: Write Failing Test - ç¼–å†™å¤±è´¥æµ‹è¯•
```javascript
// ç¤ºä¾‹ï¼šä¸ºBugç¼–å†™æµ‹è¯•ç”¨ä¾‹
describe('LoginComponent', () => {
  it('should handle login with valid credentials', async () => {
    // è¿™ä¸ªæµ‹è¯•åº”è¯¥å¤±è´¥ï¼Œå› ä¸ºBugå­˜åœ¨
    const mockUser = { username: 'test', password: 'password' };
    const result = await loginComponent.handleLogin(mockUser);
    
    expect(result.success).toBe(true);
    expect(result.token).toBeDefined();
    expect(result.user).toEqual(expect.objectContaining({
      username: 'test'
    }));
  });

  it('should handle undefined response gracefully', async () => {
    // æµ‹è¯•è¾¹ç•Œæ¡ä»¶
    mockApiService.login.mockResolvedValue(undefined);
    
    const result = await loginComponent.handleLogin(mockUser);
    expect(result.success).toBe(false);
    expect(result.error).toBeDefined();
  });
});
```

#### Step 3: Implement the Fix - å®ç°ä¿®å¤
```typescript
// ä¿®å¤å‰çš„ä»£ç 
async handleLogin(credentials: LoginCredentials) {
  try {
    const response = await this.authService.login(credentials);
    // Bug: æ²¡æœ‰æ£€æŸ¥responseæ˜¯å¦å­˜åœ¨
    localStorage.setItem('token', response.token);
    this.router.navigate(['/dashboard']);
  } catch (error) {
    this.showError('ç™»å½•å¤±è´¥');
  }
}

// ä¿®å¤åçš„ä»£ç 
async handleLogin(credentials: LoginCredentials) {
  try {
    const response = await this.authService.login(credentials);
    
    // ä¿®å¤: æ·»åŠ å“åº”éªŒè¯
    if (!response || !response.token) {
      throw new Error('Invalid response from server');
    }
    
    localStorage.setItem('token', response.token);
    this.router.navigate(['/dashboard']);
    return { success: true, token: response.token, user: response.user };
  } catch (error) {
    console.error('Login error:', error);
    this.showError('ç™»å½•å¤±è´¥: ' + error.message);
    return { success: false, error: error.message };
  }
}
```

#### Step 4: Verify Test Passes - éªŒè¯æµ‹è¯•é€šè¿‡
```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•
npm test -- --grep "LoginComponent"

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# ç¡®ä¿æµ‹è¯•é€šè¿‡
âœ“ should handle login with valid credentials
âœ“ should handle undefined response gracefully
```

#### Step 5: Run Full Test Suite - è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ç¡®ä¿æ²¡æœ‰å›å½’
npm run test:all

# è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
npm run test:e2e

# è¿è¡Œä»£ç æ£€æŸ¥
npm run lint

# è¿è¡Œç±»å‹æ£€æŸ¥
npm run type-check
```

### âœ… On Completion - å®Œæˆåæ“ä½œ

#### 1. Git Commit - Gitæäº¤
```bash
# æš‚å­˜å˜æ›´
git add .

# æäº¤å˜æ›´ï¼Œå¼•ç”¨é—®é¢˜ç¼–å·
git commit -m "ğŸ› fix(auth): ä¿®å¤ç™»å½•æ—¶tokenæœªå®šä¹‰é”™è¯¯ (#123)

- æ·»åŠ å“åº”éªŒè¯é˜²æ­¢undefinedé”™è¯¯
- æ”¹è¿›é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
- æ·»åŠ è¾¹ç•Œæ¡ä»¶æµ‹è¯•ç”¨ä¾‹

ä¿®å¤äº†å½“æœåŠ¡å™¨è¿”å›ç©ºå“åº”æ—¶çš„å´©æºƒé—®é¢˜
ç°åœ¨ä¼šæ˜¾ç¤ºæœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯ç»™ç”¨æˆ·

Fixes #123"
```

#### 2. Push Branch - æ¨é€åˆ†æ”¯
```bash
# æ¨é€åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“
git push origin fix/login-token-error
```

#### 3. Create Pull Request - åˆ›å»ºæ‹‰å–è¯·æ±‚
```markdown
## ğŸ› Bug Fix: ä¿®å¤ç™»å½•æ—¶tokenæœªå®šä¹‰é”™è¯¯

### é—®é¢˜æè¿°
ä¿®å¤ #123 - ç”¨æˆ·ç™»å½•æ—¶é‡åˆ°"Cannot read property 'token' of undefined"é”™è¯¯

### æ ¹æœ¬åŸå› 
å½“è®¤è¯æœåŠ¡è¿”å›ç©ºå“åº”æˆ–æ ¼å¼ä¸æ­£ç¡®çš„å“åº”æ—¶ï¼Œä»£ç æ²¡æœ‰è¿›è¡Œé€‚å½“çš„éªŒè¯å°±å°è¯•è®¿é—®`token`å±æ€§ã€‚

### è§£å†³æ–¹æ¡ˆ
- âœ… æ·»åŠ å“åº”éªŒè¯é€»è¾‘
- âœ… æ”¹è¿›é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… æ·»åŠ æœ‰æ„ä¹‰çš„ç”¨æˆ·åé¦ˆ
- âœ… å¢åŠ è¾¹ç•Œæ¡ä»¶æµ‹è¯•

### æµ‹è¯•
- [x] å•å…ƒæµ‹è¯•é€šè¿‡
- [x] é›†æˆæµ‹è¯•é€šè¿‡
- [x] æ‰‹åŠ¨æµ‹è¯•éªŒè¯
- [x] å›å½’æµ‹è¯•é€šè¿‡

### å½±å“èŒƒå›´
- ä»…å½±å“ç™»å½•ç»„ä»¶
- å‘åå…¼å®¹
- æ— ç ´åæ€§å˜æ›´

### æˆªå›¾/å½•å±
[æ·»åŠ ä¿®å¤åçš„æˆªå›¾æˆ–å½•å±]

### æ£€æŸ¥æ¸…å•
- [x] ä»£ç å®¡æŸ¥å®Œæˆ
- [x] æµ‹è¯•è¦†ç›–ç‡å……è¶³
- [x] æ–‡æ¡£å·²æ›´æ–°
- [x] æ— å®‰å…¨é£é™©
```

## ğŸ” Root Cause Analysis - æ ¹å› åˆ†æ

### Five Whys Technique - äº”ä¸ªä¸ºä»€ä¹ˆæŠ€æœ¯
```
1. ä¸ºä»€ä¹ˆç™»å½•å¤±è´¥ï¼Ÿ
   â†’ å› ä¸ºä»£ç å°è¯•è®¿é—®undefinedå¯¹è±¡çš„tokenå±æ€§

2. ä¸ºä»€ä¹ˆresponseæ˜¯undefinedï¼Ÿ
   â†’ å› ä¸ºAPIæœåŠ¡åœ¨æŸäº›æƒ…å†µä¸‹è¿”å›ç©ºå“åº”

3. ä¸ºä»€ä¹ˆAPIæœåŠ¡è¿”å›ç©ºå“åº”ï¼Ÿ
   â†’ å› ä¸ºç½‘ç»œè¶…æ—¶æˆ–æœåŠ¡å™¨é”™è¯¯æ—¶æ²¡æœ‰æ­£ç¡®å¤„ç†

4. ä¸ºä»€ä¹ˆæ²¡æœ‰éªŒè¯å“åº”ï¼Ÿ
   â†’ å› ä¸ºå¼€å‘æ—¶å‡è®¾APIæ€»æ˜¯è¿”å›æœ‰æ•ˆå“åº”

5. ä¸ºä»€ä¹ˆæ²¡æœ‰è€ƒè™‘é”™è¯¯æƒ…å†µï¼Ÿ
   â†’ å› ä¸ºç¼ºå°‘é”™è¯¯å¤„ç†çš„æœ€ä½³å®è·µæŒ‡å¯¼
```

### Prevention Measures - é¢„é˜²æªæ–½
- æ·»åŠ å“åº”éªŒè¯æ¨¡å¼
- å®æ–½é”™è¯¯å¤„ç†æ ‡å‡†
- å¢åŠ è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•æ›´æ–°

## ğŸ“Š Bug Categories - Bugåˆ†ç±»

### Severity Levels - ä¸¥é‡ç¨‹åº¦
- **Critical** - ç³»ç»Ÿå´©æºƒï¼Œæ•°æ®ä¸¢å¤±
- **High** - æ ¸å¿ƒåŠŸèƒ½æ— æ³•ä½¿ç”¨
- **Medium** - åŠŸèƒ½å—é™ï¼Œæœ‰å˜é€šæ–¹æ¡ˆ
- **Low** - ç•Œé¢é—®é¢˜ï¼Œä¸å½±å“åŠŸèƒ½

### Bug Types - Bugç±»å‹
- **Logic Error** - é€»è¾‘é”™è¯¯
- **Runtime Error** - è¿è¡Œæ—¶é”™è¯¯
- **UI/UX Issue** - ç•Œé¢/ä½“éªŒé—®é¢˜
- **Performance** - æ€§èƒ½é—®é¢˜
- **Security** - å®‰å…¨æ¼æ´
- **Compatibility** - å…¼å®¹æ€§é—®é¢˜

## ğŸ› ï¸ Tools and Techniques - å·¥å…·å’ŒæŠ€æœ¯

### Debugging Tools - è°ƒè¯•å·¥å…·
```bash
# æµè§ˆå™¨å¼€å‘è€…å·¥å…·
F12 â†’ Console/Network/Sources

# Node.jsè°ƒè¯•
node --inspect-brk app.js

# VS Codeè°ƒè¯•é…ç½®
{
  "type": "node",
  "request": "launch",
  "name": "Debug App",
  "program": "${workspaceFolder}/src/index.js"
}
```

### Logging and Monitoring - æ—¥å¿—å’Œç›‘æ§
```javascript
// ç»“æ„åŒ–æ—¥å¿—
console.log('Login attempt', {
  timestamp: new Date().toISOString(),
  userId: credentials.username,
  userAgent: navigator.userAgent,
  error: error.message
});

// é”™è¯¯ç›‘æ§é›†æˆ
import * as Sentry from '@sentry/browser';
Sentry.captureException(error);
```

## âœ… Best Practices - æœ€ä½³å®è·µ

### Bug Prevention - Bugé¢„é˜²
- **ä»£ç å®¡æŸ¥** - æ‰€æœ‰ä»£ç å˜æ›´éƒ½è¦å®¡æŸ¥
- **æµ‹è¯•é©±åŠ¨** - å…ˆå†™æµ‹è¯•ï¼Œåå†™ä»£ç 
- **é™æ€åˆ†æ** - ä½¿ç”¨ESLintã€TypeScriptç­‰å·¥å…·
- **æŒç»­é›†æˆ** - è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²

### Bug Fixing - Bugä¿®å¤
- **é‡ç°ä¼˜å…ˆ** - ç¡®ä¿èƒ½ç¨³å®šé‡ç°Bug
- **æœ€å°å˜æ›´** - åªä¿®æ”¹å¿…è¦çš„ä»£ç 
- **æµ‹è¯•è¦†ç›–** - ä¸ºBugæ·»åŠ æµ‹è¯•ç”¨ä¾‹
- **æ–‡æ¡£æ›´æ–°** - æ›´æ–°ç›¸å…³æ–‡æ¡£

### Communication - æ²Ÿé€š
- **åŠæ—¶æ›´æ–°** - å®šæœŸæ›´æ–°IssueçŠ¶æ€
- **æ¸…æ™°æè¿°** - è¯¦ç»†æè¿°é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- **çŸ¥è¯†åˆ†äº«** - åˆ†äº«ä¿®å¤ç»éªŒå’Œæ•™è®­
